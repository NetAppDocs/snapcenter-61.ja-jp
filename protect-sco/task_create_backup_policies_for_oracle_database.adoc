---
permalink: protect-sco/task_create_backup_policies_for_oracle_database.html 
sidebar: sidebar 
keywords: backup policies, policies 
summary: SnapCenterを使用してOracleデータベース リソースをバックアップする前に、バックアップ対象のリソースまたはリソース グループのバックアップ ポリシーを作成する必要があります。バックアップ ポリシーとは、バックアップをどのように管理し、スケジューリングし、保持するかを定める一連のルールです。レプリケーション、スクリプト、バックアップ タイプの設定を指定することもできます。ポリシーを作成することで、別のリソースやリソース グループでポリシーを再利用したい場合に時間を節約できます。 
---
= Oracleデータベースのバックアップ ポリシーの作成
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapCenterを使用してOracleデータベース リソースをバックアップする前に、バックアップ対象のリソースまたはリソース グループのバックアップ ポリシーを作成する必要があります。バックアップ ポリシーとは、バックアップをどのように管理し、スケジューリングし、保持するかを定める一連のルールです。レプリケーション、スクリプト、バックアップ タイプの設定を指定することもできます。ポリシーを作成することで、別のリソースやリソース グループでポリシーを再利用したい場合に時間を節約できます。

*始める前に*

* バックアップ戦略を定義しておく必要があります。
* SnapCenterのインストール、ホストの追加、データベースの検出、ストレージ システム接続の作成などのタスクを実行して、データ保護の準備をしておく必要があります。
* Snapshotをミラー セカンダリ ストレージまたはバックアップ セカンダリ ストレージにレプリケートするユーザには、SnapCenter管理者がソースとデスティネーションの両方のボリューム用にSVMを割り当てる必要があります。
* root以外のユーザとしてプラグインをインストールした場合は、実行権限をプリスクリプト ディレクトリとポストスクリプト ディレクトリに手動で割り当てる必要があります。
* SnapMirrorアクティブ同期に固有の前提条件と制限事項を確認します。詳細については、 https://docs.netapp.com/us-en/ontap/smbc/considerations-limits.html#volumes["SnapMirrorアクティブ同期のオブジェクト数の制限"] 。


.タスク概要
[Retain the backup copies for a specific number of days]オプションを選択した場合は、SnapLockの保持期間をここで指定した保持日数以下にする必要があります。

+ スナップショットのロック期間を指定すると、保持期間が終了するまでスナップショットが削除されなくなります。その結果、ポリシーで指定した数よりも多くのSnapshotが保持される可能性があります。

+ ONTAP 9.12.1 以下のバージョンでは、リストアの一環としてSnapLock Vault スナップショットから作成されたクローンには、 SnapLock Vault の有効期限が継承されます。SnapLockの有効期限が過ぎたあと、ストレージ管理者がクローンを手動でクリーンアップする必要があります。

*手順*

. 左側のナビゲーション ペインで、[*設定*] をクリックします。
. [設定]ページで、[*ポリシー*]をクリックします。
. ドロップダウンリストから*Oracle Database*を選択します。
. *新規*をクリックします。
. 「名前」ページで、ポリシー名と詳細を入力します。
. ポリシー タイプ ページで、次の手順を実行します。
+
.. ストレージタイプを選択します。
.. ポリシーのスコープを選択:
+
*** *オンライン バックアップを作成*する場合は、[オンライン バックアップ] を選択します。
+
データファイル、制御ファイル、アーカイブ ログ ファイルすべて、データファイルと制御ファイルのみ、アーカイブ ログ ファイルのみのいずれをバックアップするかを指定する必要があります。

*** *オフライン バックアップを作成*する場合は、[*オフライン バックアップ*] を選択し、次のいずれかのオプションを選択します。
+
**** データベースがマウントされた状態のときにオフライン バックアップを作成する場合は、[マウント] を選択します。
**** データベースをシャットダウン状態に変更してオフライン シャットダウン バックアップを作成する場合は、「シャットダウン」を選択します。
+
プラガブル データベース (PDB) があり、バックアップを作成する前に PDB の状態を保存する場合は、「PDB の状態を保存」を選択する必要があります。これにより、バックアップ作成後にPDBを元の状態に戻すことができます。





.. Oracle Recovery Manager (RMAN) を使用してバックアップをカタログ化する場合は、「*Oracle Recovery Manager (RMAN) を使用したバックアップのカタログ化*」を選択します。
+
GUIまたはSnapCenter CLIコマンドCatalog-SmBackupWithOracleRMANを使用して、一度に1つのバックアップのカタログ化を遅らせて実行できます。

+

NOTE: RACデータベースのバックアップをカタログ化する場合は、そのデータベースに対して他のジョブが実行されていないことを確認します。別のジョブが実行されている場合は、カタログ化処理がキューに登録されずに失敗します。

.. バックアップ後にアーカイブ ログを削除する場合は、[*バックアップ後にアーカイブ ログを削除する*] を選択します。
+

NOTE: データベースで設定されていないアーカイブ ログ デスティネーションからのアーカイブ ログの削除はスキップされます。

+

IMPORTANT: Oracle Standard Editionを使用している場合は、アーカイブ ログのバックアップ中にLOG_ARCHIVE_DESTパラメータとLOG_ARCHIVE_DUPLEX_DESTパラメータを使用できます。

+
*** アーカイブ ログを削除できるのは、アーカイブ ログ ファイルをバックアップの一部として選択した場合だけです。
+

NOTE: 削除処理を正常に行うためには、RAC環境のすべてのノードがすべてのアーカイブ ログの場所にアクセスできることを確認する必要があります。

+
|===
| 状況 | 操作 


 a| 
すべてのアーカイブ ログを削除
 a| 
*すべてのアーカイブ ログを削除*を選択します。



 a| 
古いアーカイブ ログを削除
 a| 
*次の期間より古いアーカイブ ログを削除する* を選択し、削除するアーカイブ ログの保存期間を日数と時間で指定します。



 a| 
すべてのデスティネーションからアーカイブ ログを削除
 a| 
*すべての保存先からアーカイブ ログを削除する* を選択します。



 a| 
バックアップの一部であるログ デスティネーションからアーカイブ ログを削除
 a| 
*バックアップの一部である保存先からアーカイブ ログを削除する* を選択します。

|===
+
image:../media/sco_backuppolicy_prunning.gif["剪定方針"]





. スナップショットとレプリケーション ページで、次の手順を実行します。
+
.. *オンデマンド*、*時間別*、*日次*、*週次*、または*月次*を選択して、スケジュールの頻度を指定します。
+

NOTE: リソース グループを作成する際に、バックアップ処理のスケジュール（開始日と終了日）を指定することができます。これにより、ポリシーとバックアップ間隔が同じである複数のリソース グループを作成できますが、各ポリシーに異なるバックアップ スケジュールを割り当てることもできます。

+

NOTE: 午前 2 時にスケジュールを設定した場合、夏時間 (DST) 中はスケジュールは実行されません。

.. データ スナップショットの保持設定セクションで、バックアップ タイプ ページで選択したバックアップ タイプとスケジュール タイプの保持設定を指定します。
+
|===


| 状況 | 操作 


 a| 
特定の数のSnapshotを保持
 a| 
*保持するコピー*を選択し、保持するスナップショットの数を指定します。

Snapshotの数が指定した数を超えると、古いものから順にSnapshotが削除されます。


NOTE: 最大保持値は 1018 です。保持数を、使用しているONTAPバージョンがサポートする値よりも大きい値に設定すると、バックアップが失敗します。


IMPORTANT: SnapVaultレプリケーションを有効にする場合は、保持数を2以上に設定する必要があります。保持数を1に設定すると、新しいSnapshotがターゲットにレプリケートされるまで最初のSnapshotがSnapVault関係の参照Snapshotになるため、保持処理が失敗することがあります。



 a| 
Snapshotを特定の日数だけ保持
 a| 
*コピーの保持期間*を選択し、スナップショットを削除する前に保持する日数を指定します。



 a| 
スナップショットコピーのロック期間
 a| 
*スナップショット コピーのロック期間* を選択し、期間を日数、月数、または年数で指定します。

SnapLock保持期間は100年未満にする必要があります。

|===
.. アーカイブ ログ スナップショットの保持設定セクションで、バックアップ タイプ ページで選択したバックアップ タイプとスケジュール タイプの保持設定を指定します。
+
|===


| 状況 | 操作 


 a| 
特定の数のSnapshotを保持
 a| 
*保持するコピー*を選択し、保持するスナップショットの数を指定します。

Snapshotの数が指定した数を超えると、古いものから順にSnapshotが削除されます。


NOTE: 最大保持値は 1018 です。保持数を、使用しているONTAPバージョンがサポートする値よりも大きい値に設定すると、バックアップが失敗します。


IMPORTANT: SnapVaultレプリケーションを有効にする場合は、保持数を2以上に設定する必要があります。保持数を1に設定すると、新しいSnapshotがターゲットにレプリケートされるまで最初のSnapshotがSnapVault関係の参照Snapshotになるため、保持処理が失敗することがあります。



 a| 
Snapshotを特定の日数だけ保持
 a| 
*コピーの保持期間*を選択し、スナップショットを削除する前に保持する日数を指定します。



 a| 
スナップショットコピーのロック期間
 a| 
*スナップショット コピーのロック期間* を選択し、期間を日数、月数、または年数で指定します。

SnapLock保持期間は100年未満にする必要があります。

|===
.. ポリシーラベルを選択します。
+

NOTE: リモート レプリケーションのプライマリ スナップショットにSnapMirrorラベルを割り当てることで、プライマリ スナップショットによってスナップショット レプリケーション操作をSnapCenterからONTAPセカンダリ システムにオフロードできるようになります。これは、ポリシー ページでSnapMirrorまたはSnapVaultオプションを有効にしなくても実行できます。



. [セカンダリ レプリケーション オプションの選択] セクションで、次のセカンダリ レプリケーション オプションの 1 つまたは両方を選択します。
+

NOTE: *セカンダリ スナップショット コピーのロック期間* を有効にするには、セカンダリ レプリケーション オプションを選択する必要があります。

+
|===
| フィールド | 操作 


 a| 
Update SnapMirror after creating a local Snapshot
 a| 
別のボリュームにバックアップ セットのミラー コピーを作成する場合（SnapMirrorレプリケーション）は、このフィールドを選択します。

このオプションは、SnapMirrorアクティブ同期に対して有効にする必要があります。

セカンダリ レプリケーションのSnapLockの有効期限には、プライマリSnapLockの有効期限がロードされます。

トポロジ ページの *更新* ボタンをクリックすると、 ONTAPから取得されたセカンダリおよびプライマリSnapLock の有効期限が更新されます。



 a| 
Update SnapVault after creating a local Snapshot
 a| 
ディスクツーディスクのバックアップ レプリケーション（SnapVaultバックアップ）を実行する場合は、このオプションを選択します。

SnapLock がSnapLock Vault と呼ばれるONTAPのセカンダリにのみ設定されている場合、[トポロジ] ページの [更新] ボタンをクリックすると、 ONTAPから取得されたセカンダリのロック期間が更新されます。

SnapLock Vaultの詳細については、 https://docs.netapp.com/us-en/ontap/snaplock/commit-snapshot-copies-worm-concept.html["バックアップ デスティネーションのSnapshotコピーのWORM状態へのコミット"]

見るlink:../protect-sco/task_view_oracle_databse_backups_and_clones_in_the_topology_page.html["[Topology]ページでのOracleデータベースのバックアップとクローンの表示"] 。



 a| 
Error retry count
 a| 
処理が停止されるまでに試行できるレプリケーションの最大回数を入力します。

|===
+

NOTE: セカンダリ ストレージでSnapshotの上限に達しないように、ONTAPでセカンダリ ストレージのSnapMirror保持ポリシーを設定する必要があります。

. [Script]ページで、バックアップ処理の前またはあとに実行するプリスクリプトまたはポストスクリプトのパスと引数を入力します。
+
プレスクリプトとポストスクリプトは、_/var/opt/snapcenter/spl/scripts_ またはこのパス内の任意のフォルダーに保存する必要があります。デフォルトでは、_/var/opt/snapcenter/spl/scripts_ パスが設定されます。スクリプトを保存するフォルダをこのパス内に作成してある場合は、パス内のそれらのフォルダを指定する必要があります。

+
スクリプトのタイムアウト値を指定することもできます。デフォルト値は60秒です。

+
SnapCenter、事前スクリプトと事後スクリプトを実行するときに、事前定義された環境変数を使用できます。link:../protect-sco/predefined-environment-variables-prescript-postscript-backup.html["詳細情報"^]

. [Verification]ページで、次の手順を実行します。
+
.. 検証処理の実行対象となるバックアップ スケジュールを選択します。
.. [Verification script commands]セクションで、検証処理の前後に実行するプリスクリプトまたはポストスクリプトの引数とパスを入力します。
+
プレスクリプトとポストスクリプトは、_/var/opt/snapcenter/spl/scripts_ またはこのパス内の任意のフォルダーに保存する必要があります。デフォルトでは、_/var/opt/snapcenter/spl/scripts_ パスが設定されます。スクリプトを保存するフォルダをこのパス内に作成してある場合は、パス内のそれらのフォルダを指定する必要があります。

+
スクリプトのタイムアウト値を指定することもできます。デフォルト値は60秒です。



. 概要を確認し、[完了] をクリックします。

