---
permalink: protect-sco/task_clone_a_pluggable_database.html 
sidebar: sidebar 
keywords: clone, pluggable database, PDB 
summary: 'プラガブル データベース (PDB) を、同じホストまたは代替ホスト上の異なるターゲット CDB または同じターゲット CDB にクローンできます。クローニングされたPDBを目的のSCNまたは日時にリカバリすることもできます。' 
---
= プラガブル データベースのクローニング
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
プラガブル データベース（PDB）は、同じホストまたは代替ホスト上の別のターゲットCDBまたは同じターゲットCDBにクローニングできます。クローニングされたPDBを目的のSCNまたは日時にリカバリすることもできます。

*始める前に*

root以外のユーザとしてプラグインをインストールした場合は、実行権限をプリスクリプト ディレクトリとポストスクリプト ディレクトリに手動で割り当てる必要があります。

*手順*

. 左側のナビゲーション ペインで [*リソース*] をクリックし、リストから適切なプラグインを選択します。
. [リソース] ページで、[表示] リストから [データベース] または [リソース グループ] を選択します。
. データベースの詳細ビューまたはリソース グループの詳細ビューで、タイプが単一インスタンス（マルチテナント）のデータベースを選択します。
+
データベース トポロジのページが表示されます。

. [Manage Copies]ビューで、ローカル コピー（プライマリ）、ミラー コピー（セカンダリ）、バックアップ コピー（セカンダリ）のいずれかのバックアップを選択します。
. 表からバックアップを選択し、*をクリックします。image:../media/clone_icon.gif["クローンアイコン"] *。
. [Name]ページで、次の操作を実行します。
+
.. *PDB クローン*を選択します。
.. クローニングするPDBを指定します。
+

NOTE: PDBは一度に1つずつしかクローニングできません。

.. クローンPDBの名前を指定します。


. [Locations]ページで、次の操作を実行します。
+
|===


| フィールド | 操作 


 a| 
Clone host
 a| 
ソース データベース ホストがデフォルトで入力されています。

代替ホストにクローンを作成する場合は、ソース データベース ホストと同じバージョンのOracleおよびOSがインストールされているホストを選択します。



 a| 
Target CDB
 a| 
クローンPDBを含めるCDBを選択します。

ターゲットCDBが実行されていることを確認する必要があります。



 a| 
Database State
 a| 
PDB を READ-WRITE モードで開く場合は、*クローンされた PDB を READ-WRITE モードで開く* チェックボックスを選択します。



 a| 
Datafile locations
 a| 
データ ファイルの場所がデフォルトで入力されています。

SANファイルシステムまたはNFSファイルシステム用にSnapCenterで設定されているデフォルトの命名規則は、FileSystemNameofsourcedatabase_SCJOBIDです。

SnapCenterで設定されているASMディスク グループのデフォルトの命名規則は、SC_HASHCODEofDISKGROUP_SCJOBIDです。HASHCODEofDISKGROUPは、自動生成される2～10桁の数値で、各ASMディスク グループに固有です。


NOTE: ASMディスク グループ名をカスタマイズする場合は、名前の長さがOracleでサポートされる最大長に準拠していることを確認してください。

別のパスを指定する場合は、クローン データベースのデータファイル マウント ポイントまたはASMディスク グループ名を入力する必要があります。

|===
+
Oracleホーム、ユーザ名、およびグループの詳細が、ソース データベースから自動的に入力されます。値は、クローンが作成されるホストのOracle環境に基づいて変更できます。

. [PreOps]ページで、次の手順を実行します。
+
.. クローニング処理の前に実行するプリスクリプトのパスと引数を入力します。
+
プリスクリプトは、/var/opt/snapcenter/spl/scriptsまたはこのパス内の任意のフォルダに保存する必要があります。デフォルトでは、/var/opt/snapcenter/spl/scriptsがパスとして入力されています。スクリプトをこのパス内の任意のフォルダに配置した場合は、スクリプトの配置先となるフォルダまでの完全なパスを指定する必要があります。

+
SnapCenter、事前スクリプトと事後スクリプトを実行するときに、事前定義された環境変数を使用できます。link:../protect-sco/predefined-environment-variables-prescript-postscript-clone.html["詳細情報"^]

.. [Auxiliary CDB clone database parameter settings]セクションで、データベースの初期化に使用される事前入力されたデータベース パラメータの値を変更します。


. *リセット*をクリックすると、デフォルトのデータベース パラメータ設定が取得されます。
. PostOps ページでは、クローンされたデータベースのリカバリを実行するために、デフォルトで *キャンセルまで* が選択されます。
+
SnapCenter が適切なログ バックアップを見つけられない場合は、[キャンセルまで] オプションは選択されません。 *外部アーカイブ ログの場所の指定*でログ バックアップが利用できない場合は、外部アーカイブ ログの場所を指定できます。ログの場所は複数指定できます。

+

NOTE: フラッシュ リカバリ領域（FRA）とOracle Managed Files（OMF）をサポートするように設定されているソース データベースをクローニングする場合は、リカバリのログ デスティネーションもOMFディレクトリ構造に従っている必要があります。

+
|===
| フィールド名 | 説明 


 a| 
キャンセルまで
 a| 
SnapCenterは、クローニング対象として選択されたデータ バックアップのあとに、破損していない一連のアーカイブ ログを含む最新のログ バックアップをマウントすることでリカバリを実行します。

プライマリ ストレージでクローニングを実行するには、ログとデータのバックアップをプライマリ ストレージに配置し、セカンダリ ストレージでクローニングを実行するには、ログとデータのバックアップをセカンダリ ストレージに配置する必要があります。クローン データベースは、欠落または破損したログ ファイルまでリカバリされます。



 a| 
Date and time
 a| 
SnapCenterは、指定された日時までデータベースをリカバリします。


NOTE: 時刻は24時間形式で指定できます。



 a| 
Until SCN (System Change Number)
 a| 
SnapCenterは、指定されたシステム変更番号（SCN）までデータベースをリカバリします。



 a| 
Specify external archive log locations
 a| 
外部アーカイブ ログの場所を指定します。



 a| 
新しいDBIDを作成する
 a| 
デフォルトでは、補助クローン データベースの *新しい DBID の作成* チェック ボックスは選択されていません。

ソース データベースと補助クローン データベースを区別するための一意の番号（DBID）を生成する場合は、このチェック ボックスを選択します。



 a| 
一時表領域用の一時ファイルを作成する
 a| 
クローン データベースのデフォルトの一時表領域用の一時ファイルを作成する場合は、このチェック ボックスを選択します。

このチェック ボックスをオフにすると、一時ファイルなしでデータベース クローンが作成されます。



 a| 
Enter sql entries to apply when clone is created
 a| 
クローンの作成時に適用するSQLエントリを追加します。



 a| 
Enter scripts to run after clone operation
 a| 
クローニング処理のあとに実行するポストスクリプトのパスと引数を指定します。

ポストスクリプトは、_/var/opt/snapcenter/spl/scripts_ またはこのパス内の任意のフォルダーに保存する必要があります。

デフォルトでは、_/var/opt/snapcenter/spl/scripts_ パスが設定されます。スクリプトをこのパス内の任意のフォルダに配置した場合は、スクリプトの配置先となるフォルダまでの完全なパスを指定する必要があります。


NOTE: クローニング処理が失敗した場合、ポストスクリプトは実行されず、クリーンアップ アクティビティが直接トリガーされます。

|===
. 通知ページの *電子メール設定* ドロップダウン リストから、電子メールを送信するシナリオを選択します。
+
また、送信者と受信者のEメール アドレス、およびEメールの件名を指定する必要があります。実行されたクローン操作のレポートを添付する場合は、「*ジョブ レポートの添付*」を選択します。

+

NOTE: Eメール通知を利用する場合は、GUIまたはPowerShellのSet-SmSmtpServerコマンドを使用して、SMTPサーバの詳細を指定しておく必要があります。

. 概要を確認し、[完了] をクリックします。
. *モニター* > *ジョブ* をクリックして、操作の進行状況を監視します。


*終わったら*

クローニングされたPDBのバックアップを作成する場合は、PDBのクローニング先となるターゲットCDBをバックアップする必要があります。クローニングされたPDBのみをバックアップすることはできません。セカンダリ関係を使用してバックアップを作成する場合は、ターゲットCDBのセカンダリ関係を作成する必要があります。

RACセットアップでは、クローニングされたPDBのストレージは、PDBのクローニングが実行されたノードにのみ接続されます。RACの他のノードのPDBはマウント状態です。クローニングされたPDBに他のノードからアクセスできるようにするには、ストレージを他のノードに手動で接続する必要があります。

*詳細情報*

* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/ORA-00308%3A_cannot_open_archived_log_ORA_LOG_arch1_123_456789012.arc["ORA-00308 エラーメッセージが表示され、復元またはクローン作成が失敗する"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/What_are_the_customizable_parameters_for_backup_restore_and_clone_operations_on_AIX_systems["AIX システムでのバックアップ、復元、クローン操作のカスタマイズ可能なパラメータ"^]

