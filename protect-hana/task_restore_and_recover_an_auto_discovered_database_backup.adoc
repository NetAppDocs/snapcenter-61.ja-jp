---
permalink: protect-hana/task_restore_and_recover_an_auto_discovered_database_backup.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SAP HANA Database 
summary: SnapCenterを使用して1つまたは複数のバックアップからデータをリストアおよびリカバリすることができます。 
---
= 自動検出されたデータベース バックアップのリストアとリカバリ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapCenterを使用して1つまたは複数のバックアップからデータをリストアおよびリカバリすることができます。

.開始する前に
* リソースまたはリソース グループをバックアップしておく必要があります。
* リストアするリソースまたはリソース グループに対して現在実行中のバックアップ処理がある場合は、すべてキャンセルしておく必要があります。
* リストア前、リストア後、マウント、アンマウントの各コマンドを実行する場合は、プラグイン ホストで次のパスから使用可能なコマンド リストにコマンドが存在するかどうかを確認する必要があります。
+
** Windows ホスト上のデフォルトの場所: _C:\Program Files\ NetApp\ SnapCenter\Snapcenter Plug-in Creator\etc\allowed_commands.config_
** Linux ホスト上のデフォルトの場所: _/opt/ NetApp/snapcenter/scc/etc/allowed_commands.config_





NOTE: コマンドがコマンド リストに存在しない場合、処理は失敗します。

.タスク概要
* ファイルベースのバックアップのコピーをSnapCenterからリストアすることはできません。
* SnapCenter 4.3へのアップグレード後は、SnapCenter 4.2で作成したバックアップのリストアはできますが、リカバリはできません。SnapCenter 4.2で作成したバックアップをリカバリするには、HANA StudioまたはSnapCenter外部のHANAリカバリ スクリプトを使用する必要があります。
* ONTAP 9.12.1 以前のバージョンでは、復元の一環としてSnapLock Vault スナップショットから作成されたクローンには、 SnapLock Vault の有効期限が継承されます。SnapLockの有効期限が過ぎたあと、ストレージ管理者がクローンを手動でクリーンアップする必要があります。
* SnapMirrorアクティブ同期でリストア処理を実行するには、プライマリの場所からバックアップを選択する必要があります。


.手順
. 左側のナビゲーション ペインで [*リソース*] をクリックし、リストから適切なプラグインを選択します。
. [リソース] ページで、リソース タイプに基づいて [*表示*] ドロップダウン リストからリソースをフィルターします。
+
リソースは、タイプ、ホスト、関連するリソース グループとポリシー、およびステータスとともに表示されます。

+

NOTE: リストアの実行時は、バックアップがリストア グループに対するものであっても、リストア対象のリソースを個別に選択する必要があります。

+
リソースが保護されていない場合は、「全体ステータス」列に「`保護されていません`」と表示されます。この状態になるのは、リソースが保護されていない場合とリソースが別のユーザによってバックアップされている場合です。

. リソースを選択するか、リソース グループを選択してそのグループ内のリソースを選択します。
+
リソースのトポロジ ページが表示されます。

. [コピーの管理] ビューで、プライマリまたはセカンダリ (ミラーリングまたはボールト化された) ストレージ システムから [*バックアップ*] を選択します。
. プライマリバックアップテーブルで、復元するバックアップを選択し、*をクリックします。image:../media/restore_icon.gif["復元アイコン"] *。
+
image::../media/restoring_resource.gif[資源の回復]

. 「復元範囲」ページで、「*完全なリソース*」を選択して、SAP HANA データベースの構成済みデータ ボリュームを復元します。
+

NOTE: *完全なリソース* (*ボリュームの復元*の有無にかかわらず)、または *テナント データベース* のいずれかを選択できます。

+
ユーザーが *テナント データベース* または *完全復元* オプションのいずれかを選択した場合、 SnapCenter Server では複数のテナントに対するリカバリ操作はサポートされません。リカバリ処理を実行するには、HANA StudioまたはHANA Pythonスクリプトを使用する必要があります。

+
.. ボリューム全体を復元する場合は、「ボリュームを元に戻す」を選択します。
+
このオプションは、NFS環境のSnapCenter 4.3で作成されたバックアップで使用できます。

+
リソースにボリュームまたはqtreeが含まれている場合、そのボリュームまたはqtreeのリストア用のSnapshotが選択されたあとに作成されたSnapshotは削除され、リカバリすることはできません。また、同じボリュームまたはqtreeで他のリソースがホストされている場合、そのリソースも削除されます。これは、復元に *ボリュームの復元* オプション付きの *完全なリソース* が選択されている場合に適用されます。

.. *テナント データベース* を選択します。
+
このオプションは、MDCリソースに対してのみ使用できます。

+
リストア処理を実行する前に、テナント データベースを停止してください。

+
*テナント データベース* オプションを選択した場合は、HANA スタジオを使用するか、 SnapCenter外部の HANA リカバリ スクリプトを使用してリカバリ操作を実行する必要があります。



. [Recovery scope]ページで、次のいずれかのオプションを選択します。
+
|===
| 状況 | 操作 


 a| 
現在の時刻にできる限り近い時点にリカバリする場合
 a| 
*最新の状態に回復*を選択します。単一コンテナ リソースの場合は、ログおよびカタログ バックアップの場所を1つ以上指定します。

マルチテナント データベース コンテナ（MDC）リソースの場合は、ログ バックアップの場所を1つ以上とバックアップ カタログの場所を指定します。

MDCリソースの場合、パスにシステム データベースとテナント データベースの両方のログが含まれている必要があります。



 a| 
指定した時点にリカバリする場合
 a| 
*特定の時点に回復*を選択します。

.. タイムゾーンを選択します。
+
ブラウザのタイムゾーンがデフォルトで入力されます。

+
入力した時間は、選択したタイムゾーンに基づいてGMTに変換されます。

.. 日時を入力します。たとえば、HANA Linuxホストがカリフォルニア州サニーベールにあり、ノースカロライナ州ローリーにいるユーザがログをSnapCenterにリカバリしようとしているとします。
+
これらの地点間の時差は3時間で、ユーザはノースカロライナ州ローリーからログインしているため、GUIで選択されるデフォルトのブラウザ タイムゾーンはGMT-04:00です。

+
ユーザーがカリフォルニア州サニーベールの午前5時にリカバリを実行したい場合、ユーザーはブラウザのタイムゾーンをHANA Linuxホストのタイムゾーン（GMT-07:00）に設定し、日付と時刻を午前5時に指定する必要があります。

+
単一コンテナ リソースの場合は、ログおよびカタログ バックアップの場所を1つ以上指定します。

+
MDCリソースの場合は、ログ バックアップの場所を1つ以上とバックアップ カタログの場所を指定します。

+
MDCリソースの場合、パスにシステム データベースとテナント データベースの両方のログが含まれている必要があります。





 a| 
特定の日時までリカバリする場合
 a| 
*指定されたデータ バックアップに復元*を選択します。



 a| 
リカバリが不要である場合
 a| 
*回復なし*を選択します。リカバリ処理は、HANA Studioから手動で実行する必要があります。

|===
+
SnapCenter 4.3へのアップグレード後に作成されたバックアップのみをリカバリできます。ただし、ホストとプラグインの両方がSnapCenter 4.3にアップグレードされており、リストア対象として選択されたバックアップの作成がリソースの変換またはリソースの自動検出後に行われた場合に限ります。

. [Pre ops]ページで、リストア ジョブの実行前に実行するリストア前の処理とアンマウントのコマンドを入力します。
+
自動検出されたリソースにはアンマウント コマンドを使用できません。

. [Post ops]ページで、リストア ジョブの実行後に実行するマウントとリストア後の処理のコマンドを入力します。
+
自動検出されたリソースにはマウント コマンドを使用できません。

. 通知ページの *電子メール設定* ドロップダウン リストから、電子メールを送信するシナリオを選択します。
+
また、送信者と受信者のEメール アドレス、およびEメールの件名を指定する必要があります。SMTP は、[設定] > [グローバル設定] ページでも設定する必要があります。

. 概要を確認し、[完了] をクリックします。
. *モニター* > *ジョブ* をクリックして、操作の進行状況を監視します。

