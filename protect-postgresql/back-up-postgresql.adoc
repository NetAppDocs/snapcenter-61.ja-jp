---
permalink: protect-postgresql/back-up-postgresql.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for PostgreSQL 
summary: 'どのリソース グループにもまだ含まれていないリソースは、[Resources]ページからバックアップすることができます。' 
---
= PostgreSQLのバックアップ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
どのリソース グループにもまだ含まれていないリソースは、[Resources]ページからバックアップすることができます。

.開始する前に
* バックアップ ポリシーを作成しておく必要があります。
* セカンダリ ストレージとのSnapMirror関係を持つリソースをバックアップする場合は、ストレージ ユーザーに割り当てられたONTAPロールに「`snapmirror all`」権限が含まれている必要があります。ただし、「`vsadmin`」ロールを使用している場合は、「`snapmirror all`」権限は必要ありません。
* Snapshotコピーベースのバックアップ処理の場合は、すべてのテナント クラスタが有効でアクティブであることを確認してください。
* 休止、Snapshot、および休止解除の処理を実行するプリコマンドとポストコマンドの場合は、プラグイン ホストで次のパスから使用できるコマンド リストにコマンドがあるかどうかを確認する必要があります。
+
** Windows ホスト上のデフォルトの場所: _C:\Program Files\ NetApp\ SnapCenter\Snapcenter Plug-in Creator\etc\allowed_commands.config_
** Linux ホスト上のデフォルトの場所: _/opt/ NetApp/snapcenter/scc/etc/allowed_commands.config_





NOTE: コマンドがコマンド リストに存在しない場合、処理は失敗します。

[role="tabbed-block"]
====
.SnapCenter UI
--
.手順
. 左側のナビゲーション ペインで [*リソース*] を選択し、リストから適切なプラグインを選択します。
. リソース ページで、リソース タイプに基づいて *表示* ドロップダウン リストからリソースをフィルターします。
+
*を選択image:../media/filter_icon.gif["フィルターアイコン"]*、ホスト名とリソース タイプを選択して、リソースをフィルターします。次に選択できますimage:../media/filter_icon.gif["フィルターアイコン"]フィルター パネルを閉じます。

. バックアップするリソースを選択します。
. [リソース] ページで、[*スナップショット コピーにカスタム名形式を使用する*] を選択し、スナップショット名に使用するカスタム名形式を入力します。
+
たとえば、_customtext_policy_hostname_ または _resource_hostname_ です。デフォルトでは、Snapshotの名前の後ろにタイムスタンプが付加されます。

. [Application Settings]ページで、次の操作を実行します。
+
** 追加のバックアップ オプションを設定するには、[*バックアップ*] 矢印を選択します。
+
必要に応じて、整合グループのバックアップを有効にし、次の操作を実行します。

+
|===
| フィールド | 操作 


 a| 
Afford time to wait for "Consistency Group Snapshot" operation to complete
 a| 
スナップショット操作が完了するまでの待機時間を指定するには、「緊急」、または「中」、または「緩和」を選択します。[Urgent]は5秒、[Medium]は7秒、[Relaxed]は20秒です。



 a| 
Disable WAFL Sync
 a| 
WAFL整合ポイントを強制しない場合はオンにします。

|===
** *スクリプト*矢印を選択して、静止、スナップショット、および静止解除操作の事前および事後コマンドを実行します。
+
バックアップ処理を終了する前のプリコマンドも実行できます。プリスクリプトとポストスクリプトはSnapCenter Serverで実行されます。

** **カスタム構成**矢印を選択し、このリソースを使用するすべてのジョブに必要なカスタム値のペアを入力します。
** *スナップショット コピー ツール* 矢印を選択して、スナップショットを作成するツールを選択します。
+
|===
| あなたが望むなら... | 操作 


 a| 
SnapCenterでストレージ レベルのSnapshotを作成する
 a| 
* ファイル システムの整合性のないSnapCenter * を選択します。



 a| 
SnapCenterでPlug-in for Windowsを使用してファイルシステムを整合性のある状態にしてからSnapshotを作成する
 a| 
* ファイル システムの一貫性を備えたSnapCenter * を選択します。



 a| 
Snapshotを作成するためのコマンドを入力する
 a| 
*その他*を選択し、スナップショットを作成するコマンドを入力します。

|===
+
image:../media/application_settings.gif["アプリケーション設定"]



. [Policies]ページで、次の手順を実行します。
+
.. ドロップダウン リストから1つ以上のポリシーを選択します。
+

NOTE: *をクリックしてポリシーを作成することもできますimage:../media/add_policy_from_resourcegroup.gif["ポリシーフォームリソースグループを追加する"]*。

+
[Configure schedules for selected policies]セクションに、選択したポリシーがリストされます。

.. *を選択image:../media/add_policy_from_resourcegroup.gif["ポリシーフォームリソースグループを追加する"]* スケジュールを構成するポリシーの [スケジュールの構成] 列で、
.. ポリシー _policy_name_ のスケジュールの追加 ダイアログ ボックスでスケジュールを構成し、[*OK*] を選択します。
+
_policy_name_ は選択したポリシーの名前です。

+
設定したスケジュールが[Applied Schedules]列にリストされます。



. 通知ページの *電子メール設定* ドロップダウン リストから、電子メールを送信するシナリオを選択します。
+
また、送信者と受信者のEメール アドレス、およびEメールの件名を指定する必要があります。SMTP は、*設定* > *グローバル設定* でも設定する必要があります。

. 概要を確認し、[完了] を選択します。
+
リソースのトポロジ ページが表示されます。

. *今すぐバックアップ*を選択します。
. [Backup]ページで次の手順を実行します。
+
.. リソースに複数のポリシーを適用した場合は、[*ポリシー*] ドロップダウン リストから、バックアップに使用するポリシーを選択します。
+
オンデマンド バックアップ用に選択したポリシーがバックアップ スケジュールに関連付けられている場合、オンデマンド バックアップは、スケジュール タイプの保持設定に基づいて保持されます。

.. *バックアップ*を選択します。


. *モニター* > *ジョブ* をクリックして、操作の進行状況を監視します。
+
** MetroCluster構成では、フェイルオーバー後にSnapCenterで保護関係を検出できないことがあります。
+
詳細については、以下を参照してください。 https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Unable_to_detect_SnapMirror_or_SnapVault_relationship_after_MetroCluster_failover["MetroClusterのフェイルオーバー後にSnapMirror関係またはSnapVault関係を検出できない"^]

** VMDK上のアプリケーション データをバックアップする場合に、SnapCenter Plug-in for VMware vSphereのJavaヒープ サイズが不足していると、バックアップが失敗することがあります。
+
Java ヒープ サイズを増やすには、スクリプト ファイル _/opt/netapp/init_scripts/scvservice_ を見つけます。このスクリプトでは、_do_start method_ コマンドによってSnapCenter VMware プラグイン サービスが開始されます。このコマンドを次のように更新します: _Java -jar -Xmx8192M -Xms4096M_





--
.PowerShellコマンドレット
--
.手順
. Open-SmConnectionコマンドレットを使用して、指定のユーザでSnapCenter Serverとの接続セッションを開始します。
+
[listing]
----
PS C:\> Open-SmConnection
----
+
ユーザ名とパスワードのプロンプトが表示されます。

. Add-SmResourcesコマンドレットを使用して、手動リソースを追加します。
+
次の例は、PostgreSQLインスタンスを追加する方法を示しています。

+
[listing]
----
PS C:\> Add-SmResource -HostName 10.32.212.13 -PluginCode PostgreSQL -ResourceType Instance -ResourceName postgresqlinst1 -StorageFootPrint (@{"VolumeName"="winpostgresql01_data01";"LUNName"="winpostgresql01_data01";"StorageSystem"="scsnfssvm"}) -MountPoints "D:\"
----
. Add-SmPolicyコマンドレットを使用して、バックアップ ポリシーを作成します。
. リソースを保護するか、Add-SmResourceGroupコマンドレットを使用してSnapCenterに新しいリソース グループを追加します。
. New-SmBackupコマンドレットを使用して、新しいバックアップ ジョブを開始します。
+
この例は、リソース グループをバックアップする方法を示しています。

+
[listing]
----
C:\PS> New-SMBackup -ResourceGroupName 'ResourceGroup_wback-up-clusters-using-powershell-cmdlets-postgresql.adocith_Resources'  -Policy postgresql_policy1
----
+
この例では、保護されたリソースをバックアップしています。

+
[listing]
----
C:\PS> New-SMBackup -Resources @{"Host"="10.232.204.42";"Uid"="MDC\SID";"PluginName"="postgresql"} -Policy postgresql_policy2
----
. Get-smJobSummaryReportコマンドレットを使用して、ジョブのステータス（実行中、完了、失敗）を確認します。
+
[listing]
----
PS C:\> Get-smJobSummaryReport -JobID 123
----
. Get-SmBackupReportコマンドレットを使用して、リストアやクローニングの処理を実行するバックアップIDとバックアップ名など、バックアップ ジョブの詳細を監視します。
+
[listing]
----
PS C:\> Get-SmBackupReport -JobId 351
Output:
BackedUpObjects           : {DB1}
FailedObjects             : {}
IsScheduled               : False
HasMetadata               : False
SmBackupId                : 269
SmJobId                   : 2361
StartDateTime             : 10/4/2016 11:20:45 PM
EndDateTime               : 10/4/2016 11:21:32 PM
Duration                  : 00:00:46.2536470
CreatedDateTime           : 10/4/2016 11:21:09 PM
Status                    : Completed
ProtectionGroupName       : Verify_ASUP_Message_windows
SmProtectionGroupId       : 211
PolicyName                : test2
SmPolicyId                : 20
BackupName                : Verify_ASUP_Message_windows_scc54_10-04-2016_23.20.46.2758
VerificationStatus        : NotVerified
VerificationStatuses      :
SmJobError                :
BackupType                : SCC_BACKUP
CatalogingStatus          : NotApplicable
CatalogingStatuses        :
ReportDataCreatedDateTime :
----


コマンドレットで使用できるパラメータとその説明に関する情報は、_Get-Help command_name_ を実行すると取得できます。あるいは、 https://docs.netapp.com/us-en/snapcenter-cmdlets/index.html["SnapCenterソフトウェア コマンドレット リファレンス ガイド"^] 。

--
====